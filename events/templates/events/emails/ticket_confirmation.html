<!DOCTYPE html>
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background-color: white; }
        .ticket-card { border: 1px solid #dee2e6; border-left: 5px solid #ffc107; box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15); }
        .event-section { background-color: #343a40; color: white; text-align: center; padding: 20px; }
        .event-section img { max-width: 100%; height: auto; border-radius: 4px; }
        .ticket-details { padding: 20px; }
        .ticket-title { font-size: 1.25rem; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; }
        .ticket-info-row { display: flex; margin-bottom: 8px; }
        .ticket-info-label { flex: 1; font-weight: bold; color: #6c757d; font-size: 0.85em; }
        .ticket-info-value { flex: 2; font-size: 0.9em; }
        .ticket-amount { display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e9ecef; }
        .ticket-amount .ticket-info-label { color: #6c757d; }
        .perforated-line { border-top: 2px dashed #ccc; position: relative; padding: 5px 0; }
        .footer-text { font-size: 0.8em; color: #6c757d; }
        .qr-section { text-align: center; margin: 20px 0; }
        .qr-image { border: 1px solid #dee2e6; padding: 10px; display: inline-block; background-color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="ticket-card">
            {% for ticket in booking.tickets.all %}
                <div class="event-section">
                    {% if ticket.ticket_type.event.poster %}
                        <img src="{{ 'https://mkenyaisaak.co.ke' }}{{ ticket.ticket_type.event.poster.url }}" alt="Event Poster" style="max-height: 200px; object-fit: cover;">
                    {% else %}
                        <h2 style="margin: 0;">{{ ticket.ticket_type.event.title }}</h2>
                    {% endif %}
                    <p style="margin: 10px 0 0 0; font-size: 0.9em;">
                        <strong>{{ ticket.ticket_type.event.venue }}</strong><br>
                        {{ ticket.ticket_type.event.date|date:"D, d M Y H:i" }}
                    </p>
                </div>

                <div class="ticket-details">
                    <div class="ticket-title">{{ ticket.ticket_type.event.title }}</div>

                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Ticket Type</div>
                        <div class="ticket-info-value">{{ ticket.ticket_type.name }}</div>
                    </div>

                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Ticket Code</div>
                        <div class="ticket-info-value"><strong style="font-family: monospace; font-size: 1.1em;">{{ ticket.ticket_code }}</strong></div>
                    </div>

                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Customer</div>
                        <div class="ticket-info-value">{{ booking.customer_name }}</div>
                    </div>

                    <div class="ticket-info-row">
                        <div class="ticket-info-label">M-Pesa Receipt</div>
                        <div class="ticket-info-value">
                            {% if booking.mpesa_receipt_number %}
                                <span style="color: #28a745; font-weight: bold;">{{ booking.mpesa_receipt_number }}</span>
                            {% else %}
                                {% if booking.payment_reference %}
                                    <span style="color: #17a2b8;">Processing... (Ref: {{ booking.payment_reference }})</span>
                                {% else %}
                                    <span style="color: #ffc107;">PENDING</span>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>

                    {% if booking.mpesa_transaction_date %}
                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Transaction Time</div>
                        <div class="ticket-info-value">{{ booking.mpesa_transaction_date }}</div>
                    </div>
                    {% endif %}

                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Phone</div>
                        <div class="ticket-info-value">{{ booking.customer_phone }}</div>
                    </div>

                    {% if booking.customer_email %}
                    <div class="ticket-info-row">
                        <div class="ticket-info-label">Email</div>
                        <div class="ticket-info-value">{{ booking.customer_email }}</div>
                    </div>
                    {% endif %}

                    <div class="ticket-amount">
                        <div>
                            <div style="font-size: 0.85em; color: #6c757d;">Admits</div>
                            <div>
                                <strong>
                                    {% if "family" in ticket.ticket_type.name|lower %}
                                        4 People
                                    {% else %}
                                        1 Person
                                    {% endif %}
                                </strong>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.85em; color: #6c757d;">Total Amount</div>
                            <div><strong>KES {{ booking.total_amount }}</strong></div>
                        </div>
                    </div>

                    {% if ticket.qr_code %}
                    <div class="qr-section">
                        <div class="qr-image">
                            <img src="{{ 'https://mkenyaisaak.co.ke' }}{{ ticket.qr_code.url }}" alt="Ticket QR Code" style="width: 100px; height: 100px;">
                            <div style="margin-top: 5px; font-size: 0.8em; color: #6c757d;">{{ ticket.ticket_code }}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="perforated-line">
                    <div style="display: flex; justify-content: space-between;">
                        <span class="footer-text">Mkenya Isaak 7 Million</span>
                        <span class="footer-text">#{{ ticket.ticket_code }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
